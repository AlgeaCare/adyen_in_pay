<html>

<head>
    <!-- Embed the Adyen Web stylesheet. You can add your own styling by overriding the rules in the CSS file -->
    <link rel="stylesheet" href="https://checkoutshopper-test.cdn.adyen.com/checkoutshopper/sdk/6.12.0/adyen.css">
</head>

<body>
    <div id="adyen_container"></div>
    <!-- Embed the Adyen Web script element above any other JavaScript in your checkout page. -->
    <script src="https://checkoutshopper-test.cdn.adyen.com/checkoutshopper/sdk/6.12.0/adyen.js"></script>
    <script>
        var checkout, dropin;
        async function init(clientKey, sessionId, sessionData, env, redirectURL, currency, amount, paymentMethod, brands) {
            console.log("paymentMethod " + paymentMethod);
            const globalConfiguration = {
                session: {
                    id: sessionId, // Unique identifier for the payment session.
                    sessionData: sessionData // The payment session data.
                },
                environment: env ?? 'test', // Change to 'live' for the live environment.
                amount: {
                    value: amount,
                    currency: currency
                },
                locale: 'en-US',
                countryCode: 'DE',
                clientKey: clientKey,
                paymentMethodsResponse: JSON.parse(paymentMethod),
                onPaymentCompleted: (result, component) => {
                    console.log("onPaymentCompleted");
                    console.info(result, component);
                    // Submit the redirectResult value you extracted from the returnUrl.
                    paymentDone(result)
                },
                onError: (error, component) => {
                    console.error(error.name, error.message, error.stack, component);
                    paymentError(error.message)
                },
                onChange: (state, component) => {
                    console.log("onChange");
                    console.info(state, component);
                    let box = document.getElementById('adyen_container');
                    const domRect = box.getBoundingClientRect();
                    console.log(domRect.height);
                    onHeightAdyenView(domRect.height);
                },
                beforeSubmit: (data, component, actions) => {
                    actions.resolve(data);
                },
            };
            try {
                checkout = await AdyenWeb.AdyenCheckout(globalConfiguration);
                console.log(checkout)
                dropin = new AdyenWeb.Dropin(checkout, {
                    paymentMethodComponents: brands,// [AdyenWeb.Card],
                    paymentMethodsConfiguration: {
                        card: {
                            hasHolderName: true,
                            holderNameRequired: true,
                            // onError configuration for card payments. Overrides the global configuration.
                            onError: () => { }
                        }
                    },
                    onReady: () => {
                        console.log('onReady');
                        onStarted();
                        let box = document.getElementById('adyen_container');
                        const domRect = box.getBoundingClientRect();
                        console.log(domRect.height);
                        onHeightAdyenView(domRect.height);
                    }
                }).mount('#adyen_container');//createFromAction
                //const cardComponent = new AdyenWeb.Card(checkout, {}).mount('#adyen_container');
            } catch (error) {
                paymentError(error.message);
            }
        }
        async function initAdvanced(clientKey, env, redirectURL, currency, amount, paymentMethod, brands) {
            console.log("adv paymentMethod " + paymentMethod);
            const globalConfiguration = {
                environment: env ?? 'test', // Change to 'live' for the live environment.
                amount: {
                    value: amount,
                    currency: currency
                },
                locale: 'en-US',
                countryCode: 'DE',
                clientKey: clientKey, // Public key used for client-side authentication: https://docs.adyen.com/development-resources/client-side-authentication
                paymentMethodsResponse: JSON.parse(paymentMethod),
                onPaymentCompleted: (result, component) => {
                    console.log("onPaymentCompleted");
                    console.info(result, component);
                    // Submit the redirectResult value you extracted from the returnUrl.
                    paymentDone(result)
                },
                onError: (error, component) => {
                    console.error(error.name, error.message, error.stack, component);
                    paymentError(error.message)
                },
                onChange: (state, component) => {
                    console.log("onChange");
                    console.info(state, component);
                    let box = document.getElementById('adyen_container');
                    const domRect = box.getBoundingClientRect();
                    console.log(domRect.height);
                    onHeightAdyenView(domRect.height);
                },

                onSubmit: async (state, dropin, actions) => {
                    try {
                        console.log("onSubmit");
                        console.info(state.data);
                        let result = await onPayment(state.data);
                        console.log("data:" + result)
                        actions.resolve(JSON.parse(result));
                    } catch (e) {
                        console.log(e);
                        actions.reject();
                    }

                },
                onAdditionalDetails: async (state, component, actions) => {
                    try {
                        let result = await onPaymentDetail(state.data);
                        actions.resolve(JSON.parse(result));
                    } catch (e) {
                        console.log(e);
                        actions.reject();
                    }
                },
                beforeSubmit: (data, component, actions) => {
                    actions.resolve(data);
                },
            };
            try {
                checkout = await AdyenWeb.AdyenCheckout(globalConfiguration);
                dropin = new AdyenWeb.Dropin(checkout, {
                    paymentMethodComponents: [AdyenWeb.Card],
                    paymentMethodsConfiguration: {
                        card: {
                            hasHolderName: true,
                            holderNameRequired: true,
                            // onError configuration for card payments. Overrides the global configuration.
                            onError: () => { }
                        },

                    },
                    onReady: () => {
                        console.log('onReady');
                        //const cardComponent = new AdyenWeb.Card(checkout, {}).mount('#adyen_container');
                        onStarted();
                        let box = document.getElementById('adyen_container');
                        const domRect = box.getBoundingClientRect();
                        console.log(domRect.height);
                        onHeightAdyenView(domRect.height);
                    }
                }).mount('#adyen_container');//createFromAction

            } catch (error) {
                paymentError(error.message);
            }

        }
        async function redirectResult(sessionId, redirectResult) {
            const globalConfiguration = {
                session: {
                    id: sessionId, // Unique identifier for the payment session.
                },
                environment: env ?? 'test', // Change to 'live' for the live environment.
                locale: 'en-US',
                countryCode: 'DE',
                clientKey: clientKey, // Public key used for client-side authentication: https://docs.adyen.com/development-resources/client-side-authentication
                onPaymentCompleted: (result, component) => {
                    console.info(result, component);
                    onPaymentCompleted(result)
                },
                onError: (error, component) => {
                    console.error(error.name, error.message, error.stack, component);
                    onPaymentError(error.message)
                },
                onChange: (state, component) => {
                    console.info(state, component);
                },
                beforeSubmit: (data, component, actions) => {
                    actions.resolve(data);
                },
            };
            const checkout = await AdyenWeb.AdyenCheckout(globalConfiguration);
            checkout.submitDetails({ details: { redirectResult: redirectResult } });
        }
        function unmount() {
            dropin.unmount();
        }
        function refresh() {
            dropin.closeActivePaymentMethod();
        }
    </script>
</body>

</html>